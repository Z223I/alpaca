# Maximize Profits System

This document explains how to use the profit maximization system for analyzing superduper alert performance and optimizing exit strategies.

## Overview

The maximize profits system (`code/maximize_profit.py`) performs statistical analysis and optimization of trading parameters based on historical superduper alert data. It uses a two-stage optimization approach to find the best combination of alert generation parameters and exit strategy parameters.

## Prerequisites

### ⚠️ **CRITICAL: Run Backtesting First**

**You MUST run the backtesting system before using maximize_profit.py**

The maximize profits system depends on data generated by the backtesting system. Here's why:

1. **Data Source**: `maximize_profit.py` reads alert data from the `runs/` directory structure
2. **Directory Structure**: The backtesting system creates `runs/{date}/{symbol}/run_{date}_tf{timeframe}_th{threshold}_{uuid}/` directories
3. **Alert Collection**: Only symbols that have been processed through backtesting will appear in the analysis

### Required Steps (in order):

#### 1. Disable Telegram Notifications
```bash
# IMPORTANT: Disable all Telegram users before backtesting to prevent spam
# Edit .telegram_users.csv and set enabled=false for all users except Bruce
# This prevents hundreds of test notifications during backtesting runs
```
**Edit `.telegram_users.csv`** - Set `enabled=false` for all users to prevent notification spam during backtesting.

#### 2. Update Symbols List
```bash
# Updates data/backtesting/symbols.json with latest symbols from superduper alerts
~/miniconda3/envs/alpaca/bin/python code/update_symbols_json.py
```

#### 3. Run Backtesting System
```bash
# Processes all active symbols through parametric testing
# This creates the runs/ directory structure that maximize_profit.py requires
~/miniconda3/envs/alpaca/bin/python code/backtesting.py
```

#### 4. Run Profit Maximization
```bash
# Now you can analyze the results and optimize parameters
~/miniconda3/envs/alpaca/bin/python code/maximize_profit.py --method full --max-combinations 1000
```

## How It Works

### Backtesting Creates Required Data Structure

The backtesting system:
- Reads symbols from `data/backtesting/symbols.json` where `active='yes'`
- Tests all combinations of timeframes and thresholds for each symbol/date
- Creates run directories: `runs/{date}/{symbol}/run_{date}_tf{timeframe}_th{threshold}_{uuid}/`
- Generates superduper alerts for each parameter combination
- Stores results in structured format that maximize_profit.py expects

### Maximize Profit Analyzes Results

The profit maximization system:
- Scans the `runs/` directory structure created by backtesting
- Collects all superduper alerts with their parameters (timeframe, threshold)
- Simulates various exit strategies (take profit %, trailing stop %)
- Performs statistical analysis to find optimal parameter combinations
- Generates comprehensive reports and visualizations

## Usage Examples

### Full Optimization (Recommended)
```bash
~/miniconda3/envs/alpaca/bin/python code/maximize_profit.py --method full --max-combinations 1000
```

### Hierarchical Optimization (Faster)
```bash
~/miniconda3/envs/alpaca/bin/python code/maximize_profit.py --method hierarchical --max-combinations 500
```

### Validation Only
```bash
~/miniconda3/envs/alpaca/bin/python code/maximize_profit.py --validate-only
```

## Output Files

The system generates several output files in the current directory:

- `optimization_results.json` - Detailed optimization results
- `best_parameter_trades.csv` - Individual trade data using best parameters
- `optimization_charts/` - Directory containing analysis charts and visualizations

## Common Issues

### "No alerts found" or Missing Symbols

**Problem**: You see fewer symbols than expected, or certain symbols (like AEMD) don't appear in results.

**Solution**: The symbol hasn't been processed through backtesting yet.

1. Check if symbol is in `data/backtesting/symbols.json` with `active='yes'`
2. Run backtesting system to process all active symbols
3. Then run maximize_profit.py

### Performance Considerations

- **Memory Usage**: The system loads significant amounts of historical data
- **Processing Time**: Full optimization with 1000+ combinations can take time
- **Disk Space**: Backtesting generates many run directories with data files

## Technical Details

### Directory Dependencies

```
data/backtesting/symbols.json          # Symbol list (updated by update_symbols_json.py)
↓
runs/{date}/{symbol}/run_*_tf*_th*_*/  # Generated by backtesting.py
↓
maximize_profit.py analysis            # Reads from runs/ structure
```

### Alert Data Flow

1. **Historical Data**: `historical_data/{date}/superduper_alerts_sent/bullish/green/`
2. **Symbol Detection**: `update_symbols_json.py` scans for symbols with alerts
3. **Backtesting**: Processes symbols through parametric testing
4. **Analysis**: `maximize_profit.py` analyzes results for optimization

## Environment Setup

Ensure you're using the correct conda environment:

```bash
source ~/miniconda3/etc/profile.d/conda.sh && conda activate alpaca
```

Or use the direct path method:

```bash
~/miniconda3/envs/alpaca/bin/python code/maximize_profit.py
```

## Configuration

The system automatically updates `symbols.json` before collecting alerts, ensuring you always have the latest symbol list from superduper alerts.

Key configuration files:
- `data/backtesting/symbols.json` - Active symbols list
- `data/backtesting/parameters.json` - Testing parameters (timeframes, thresholds)

## Support

For issues or questions about the maximize profits system:
1. Check this README for common solutions
2. Verify backtesting has been run for all required symbols
3. Check log output for specific error messages
4. Ensure proper conda environment activation